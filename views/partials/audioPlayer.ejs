<style>
    .rv_audio_player {
        position: fixed;
        left: 0px;
        bottom: 0px;
        width: 100%;
        height: 55px;
        z-index: 25;
        color: white;
        text-align: center;
        background-color: rgb(76, 182, 203);
    } 
    .circleBtn {
        width: 40px;
        height: 40px;
        font-size: 30px;
        border-radius: 100%;
        text-align: center;
        border: 2px white solid;
        background-color: rgba(0,0,0,0);
    }
    
    /* The audio player section. */
    .audio_buttons {
        position: absolute;
        width: 20%;
        height: 55px;
        padding-top: 7px;
    }
    
    
    /* The title area. */
    .title_area {
        position: absolute;
        width: 70%;
        height: 55px;
        text-align: center;
    }
    .sliderArea {
        position: relative;
        width: 50%;
        text-align: center;
    }
    
    
    /* The repeat/shuffle area. */
    .right_buttons {
        position: absolute;
        left: 90%;
        width: 10%;
        height: 55px;
        padding-top: 7px;
    }
    .fa-random, .fa-repeat {
        border: none;
        font-size: 24px;
        padding-top: 14px;
        background-color: rgba(0,0,0,0);
    }
    
</style>



<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>


<div class="rv_audio_player">
    
    <div class="audio_buttons">
        <button class="fa fa-step-backward circleBtn" id="stepBackBtn"></button>
        <button class="fa fa-play circleBtn" id="playBtn"></button>
        <button class="fa fa-step-forward circleBtn" id="stepForwardBtn"></button>
    </div>
    
    
    <div class="title_area">
        <p id="audio_title"></p>
        <div id="sliderArea" style="display:table;">
            <span style="display:table-cell;" id="curtimetext">0:00</span> <input style="display:table-cell;" type="range" id="seekSlider" min="0" max="100" value="0" step="1"> <span style="display:table-cell;" id="durtimetext">0:00</span>
        </div>
    </div>
    
    
    <div class="right_buttons">
        <button class="fa fa-random" id="shuffle_audio_btn"></button>
        <button class="fa fa-repeat" id="loop_audio_btn"></button>
    </div>
    
        
    
    <script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
    <script type="text/javascript" src="/stylesandscripts/firebaseconfig.js"></script>
</div>




<script>
    /* Variables */
    var stepbackBtn = document.getElementById('stepBackBtn');
    var playBtn = document.getElementById('playBtn');
    var stepforwardBtn = document.getElementById('stepForwardBtn');
    var shuffleBtn = document.getElementById('shuffle_audio_btn');
    var loopBtn = document.getElementById('loop_audio_btn');
    var title = document.getElementById('audio_title');
    
    var seekSlider = document.getElementById('seekSlider');
    var curTimeText = document.getElementById("curtimetext");
    var durTimeText = document.getElementById("durtimetext");
    
    var recitation;
    var seeking = false;
    var recording = new Audio();
    
    
    
    
    /* Methods */
    function initPlayer() {
        if (typeof(Storage) !== "undefined") {
            currentUser = JSON.parse(window.localStorage.getItem("current_user"));
            recitation = JSON.parse(window.sessionStorage.getItem("recitation_to_look_at"));

            // Load the recording
            storageRef.child(currentUser["userID"]).child(recitation.title).getDownloadURL().then(function(url) {
                // This can be downloaded directly:
                var xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = function(event) {
                    var blob = xhr.response;
                };
                xhr.open('GET', url);
                xhr.send();

                recording.src = url;
                recording.addEventListener("timeupdate", seekTimeUpdate );
            });
        }
    }
    
    
    function audioPlayer_playRecitation() {
        // Set the title area
        title.innerHTML = "<b>" + recitation.title + "</b>, Recited By: " + recitation.recited_by;
        
        // Play the audio
        recording.play();
        
        // Add the listener to update the audio bar
        seekSlider.addEventListener("mousedown", function(event) { seeking = true; seek(event); } );
        seekSlider.addEventListener("mousemove", function(event) { seek(event); } );
        seekSlider.addEventListener("mouseup", function() { seeking = false; } );
    };
    
    
    function seek(event) {
        if(seeking == true) {
            seekSlider.value = event.clientX - seekSlider.offsetLeft;
            var seekto = recording.duration * (seekSlider.value / 100);
            recording.currentTime = seekto;
        }
    }
    
    function seekTimeUpdate() {
        var newTime = recording.currentTime * (100 / recording.duration);
        seekSlider.value = newTime;
        var curmins = Math.floor(recording.currentTime / 60);
        var cursecs = Math.floor(recording.currentTime - curmins * 60);
        var durmins = Math.floor(recording.duration / 60);
        var dursecs = Math.floor(recording.duration - durmins * 60);
        if(cursecs < 10) { cursecs = "0"+cursecs; }
        if(dursecs < 10) { dursecs = "0"+dursecs; }
        if(curmins < 10) { curmins = "0"+curmins; }
        if(durmins < 10) { durmins = "0"+durmins; }
        curTimeText.innerHTML = curmins+":"+cursecs;
        durTimeText.innerHTML = durmins+":"+dursecs;
    }
    
    
    
    
    
    /* Button Clicks */
    
    loopBtn.onclick = function() {
        if(recording != null) { 
            recording.loop = !recording.loop;
            if(recording.loop == true) { loopBtn.style.color = "red"; } else { loopBtn.style.color = "white"; }
        }
    };
    
    
    window.addEventListener("load", initPlayer);
</script>
